<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘 뭐 입지?</title>
    <style>
        /* 기본 스타일 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.5;
        }

        /* 헤더 */
        .header {
            background: #fff;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        /* 메인 컨테이너 */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        /* 왼쪽 날씨 영역 */
        .weather-section {
            background: #fff;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* 현재 날씨 */
        .current-weather {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }

        .weather-icon-large {
            font-size: 80px;
            margin-right: 30px;
        }

        .current-info h2 {
            font-size: 64px;
            font-weight: 300;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        .current-location {
            font-size: 18px;
            color: #666;
            margin-bottom: 8px;
        }

        .current-desc {
            font-size: 16px;
            color: #888;
            margin-bottom: 15px;
        }

        .current-details {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }

        .current-details span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* 시간별 날씨 */
        .hourly-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #1a1a1a;
            font-weight: 600;
        }

        .hourly-chart {
            position: relative;
            height: 120px;
            margin-bottom: 20px;
        }

        .temperature-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            display: flex;
            align-items: end;
            justify-content: space-between;
            padding: 0 20px;
        }

        .temp-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .temp-value {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
        }

        .temp-dot {
            width: 8px;
            height: 8px;
            background: #ff6b35;
            border-radius: 50%;
            margin-bottom: 5px;
        }

        .hourly-details {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
        }

        .hour-item {
            text-align: center;
            padding: 15px 8px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .hour-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .hour-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .hour-temp {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
        }

        /* 오른쪽 옷차림 추천 영역 */
        .outfit-section {
            background: #fff;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            height: fit-content;
        }

        .outfit-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #1a1a1a;
            font-weight: 600;
        }

        /* 날씨 요약 */
        .weather-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .weather-summary h3 {
            font-size: 16px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .weather-summary p {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.95;
        }

        /* 옷차림 카테고리 */
        .outfit-categories {
            display: grid;
            gap: 20px;
        }

        .outfit-category {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 20px;
            background: #fafafa;
        }

        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .category-icon {
            font-size: 20px;
            margin-right: 8px;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .category-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .outfit-item {
            background: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
            border: 1px solid #ddd;
        }

        /* 특별 팁 */
        .special-tips {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }

        .special-tips h4 {
            color: #856404;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .special-tips p {
            color: #856404;
            font-size: 13px;
            line-height: 1.5;
        }

        /* 로딩 및 에러 */
        .loading {
            text-align: center;
            padding: 60px;
            font-size: 18px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #dc3545;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .retry-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 14px;
        }

        .retry-btn:hover {
            background: #0056b3;
        }

        /* 모바일 반응형 */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 20px auto;
            }

            .current-weather {
                flex-direction: column;
                text-align: center;
            }

            .weather-icon-large {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .current-info h2 {
                font-size: 48px;
            }

            .hourly-details {
                grid-template-columns: repeat(4, 1fr);
            }

            .outfit-section {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <!-- 헤더 -->
    <div class="header">
        <h1>오늘 뭐 입지?</h1>
        <p>현재 날씨에 맞는 옷차림을 추천해드립니다</p>
    </div>

    <!-- 메인 컨테이너 -->
    <div class="container" id="mainContainer">
        <div class="loading" id="loadingMessage">
            📍 위치 정보를 가져오는 중입니다...<br>
            <small style="color: #999; font-size: 14px;">위치 허용을 해주세요!</small>
        </div>
    </div>

    <script>
        // API 키 - 여기에 발급받은 OpenWeatherMap API 키가 입력되어 있습니다
        const API_KEY = 'cfe991e0dcbd01011c406026c69aaa95';

        // 날씨 아이콘 매핑
        const weatherIcons = {
            '01d': '☀️', '01n': '🌙',
            '02d': '⛅', '02n': '☁️', 
            '03d': '☁️', '03n': '☁️',
            '04d': '☁️', '04n': '☁️',
            '09d': '🌧️', '09n': '🌧️',
            '10d': '🌦️', '10n': '🌧️',
            '11d': '⛈️', '11n': '⛈️',
            '13d': '❄️', '13n': '❄️',
            '50d': '🌫️', '50n': '🌫️'
        };

        // 페이지 로드시 위치 정보 요청
        window.addEventListener('load', function() {
            requestLocation();
        });

        /**
         * 사용자 위치 정보 요청
         */
        function requestLocation() {
            if (!navigator.geolocation) {
                showError('이 브라우저는 위치 서비스를 지원하지 않습니다.');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    console.log(`위치: ${lat}, ${lon}`);
                    getWeatherData(lat, lon);
                },
                function(error) {
                    let errorMessage = '';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = '위치 접근이 거부되었습니다. 브라우저 설정에서 위치 허용을 해주세요.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = '위치 정보를 사용할 수 없습니다.';
                            break;
                        case error.TIMEOUT:
                            errorMessage = '위치 요청 시간이 초과되었습니다.';
                            break;
                        default:
                            errorMessage = '알 수 없는 오류가 발생했습니다.';
                    }
                    showError(errorMessage);
                }
            );
        }

        /**
         * 실제 날씨 데이터 가져오기
         */
        async function getWeatherData(lat, lon) {
            try {
                document.getElementById('loadingMessage').innerHTML = '🌤️ 날씨 데이터를 가져오는 중...';

                // 현재 날씨와 5일 예보 동시 요청
                const [currentResponse, forecastResponse] = await Promise.all([
                    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=kr`),
                    fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=kr`)
                ]);

                if (!currentResponse.ok || !forecastResponse.ok) {
                    throw new Error('날씨 데이터를 가져올 수 없습니다.');
                }

                const currentData = await currentResponse.json();
                const forecastData = await forecastResponse.json();

                displayWeatherData(currentData, forecastData);
                
            } catch (error) {
                console.error('날씨 데이터 오류:', error);
                showError('날씨 정보를 가져오는데 실패했습니다. 잠시 후 다시 시도해주세요.');
            }
        }

        /**
         * 날씨 데이터를 화면에 표시
         */
        function displayWeatherData(currentData, forecastData) {
            const container = document.getElementById('mainContainer');
            
            // 오늘 시간별 데이터 (24시간)
            const todayHourly = forecastData.list.slice(0, 8);
            
            // 시간별 온도 차트 데이터
            const hourlyTemps = todayHourly.map(item => Math.round(item.main.temp));
            const maxTemp = Math.max(...hourlyTemps);
            const minTemp = Math.min(...hourlyTemps);
            
            // 시간별 날씨 HTML 생성
            const hourlyItems = todayHourly.map((item, index) => {
                const date = new Date(item.dt_txt);
                const time = date.getHours();
                const timeStr = time === 0 ? '자정' : time < 12 ? `오전 ${time}시` : time === 12 ? '정오' : `오후 ${time-12}시`;
                const icon = weatherIcons[item.weather[0].icon] || '🌤️';
                const temp = Math.round(item.main.temp);
                
                // 온도 포인트 높이 계산 (상대적 위치)
                const tempPercent = maxTemp === minTemp ? 50 : ((temp - minTemp) / (maxTemp - minTemp)) * 60 + 20;
                
                return {
                    html: `
                        <div class="hour-item">
                            <div class="hour-time">${timeStr}</div>
                            <div class="hour-icon">${icon}</div>
                            <div class="hour-temp">${temp}°</div>
                        </div>
                    `,
                    tempPoint: `
                        <div class="temp-point" style="bottom: ${tempPercent}%">
                            <div class="temp-value">${temp}°</div>
                            <div class="temp-dot"></div>
                        </div>
                    `
                };
            });

            // 현재 시간
            const now = new Date();
            const currentTime = now.getHours() < 12 ? 
                `오전 ${now.getHours() === 0 ? 12 : now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}` :
                now.getHours() === 12 ? 
                `정오 12:${now.getMinutes().toString().padStart(2, '0')}` :
                `오후 ${now.getHours()-12}:${now.getMinutes().toString().padStart(2, '0')}`;

            // 옷차림 추천 생성
            const outfitRecommendation = generateOutfitRecommendation(currentData, forecastData);

            container.innerHTML = `
                <!-- 왼쪽: 날씨 정보 -->
                <div class="weather-section">
                    <!-- 현재 날씨 -->
                    <div class="current-weather">
                        <div class="weather-icon-large">${weatherIcons[currentData.weather[0].icon] || '🌤️'}</div>
                        <div class="current-info">
                            <h2>${Math.round(currentData.main.temp)}°</h2>
                            <div class="current-location">${currentData.name} • ${currentTime}</div>
                            <div class="current-desc">${translateWeatherDescription(currentData.weather[0].description)}</div>
                            <div class="current-details">
                                <span>💧 습도 ${currentData.main.humidity}%</span>
                                <span>💨 바람 ${currentData.wind.speed}m/s</span>
                                <span>🌡️ 체감 ${Math.round(currentData.main.feels_like)}°</span>
                            </div>
                        </div>
                    </div>

                    <!-- 시간별 날씨 -->
                    <div class="hourly-section">
                        <h3>오늘 시간별 날씨</h3>
                        
                        <!-- 온도 차트 -->
                        <div class="hourly-chart">
                            <div class="temperature-line">
                                ${hourlyItems.map(item => item.tempPoint).join('')}
                            </div>
                        </div>

                        <!-- 시간별 상세 정보 -->
                        <div class="hourly-details">
                            ${hourlyItems.map(item => item.html).join('')}
                        </div>
                    </div>
                </div>

                <!-- 오른쪽: 옷차림 추천 -->
                <div class="outfit-section">
                    ${outfitRecommendation}
                </div>
            `;
        }

        /**
         * 영어 날씨 설명을 한국어로 번역
         */
        function translateWeatherDescription(description) {
            const translations = {
                'clear sky': '맑음',
                'few clouds': '구름 조금',
                'scattered clouds': '구름 많음', 
                'broken clouds': '흐림',
                'overcast clouds': '흐림',
                'shower rain': '소나기',
                'rain': '비',
                'light rain': '가벼운 비',
                'moderate rain': '보통 비',
                'heavy rain': '강한 비',
                'thunderstorm': '천둥번개',
                'snow': '눈',
                'light snow': '가벼운 눈',
                'mist': '안개',
                'fog': '짙은 안개'
            };
            
            return translations[description] || description;
        }

        /**
         * 옷차림 추천 생성
         */
        function generateOutfitRecommendation(currentData, forecastData) {
            const currentTemp = currentData.main.temp;
            const feelsLike = currentData.main.feels_like;
            const humidity = currentData.main.humidity;
            const windSpeed = currentData.wind.speed;
            const weatherMain = currentData.weather[0].main.toLowerCase();
            
            // 오늘 온도 범위 계산
            const todayTemps = forecastData.list.slice(0, 8).map(item => item.main.temp);
            const maxTemp = Math.max(...todayTemps);
            const minTemp = Math.min(...todayTemps);
            
            // 날씨 상태 분석
            const isRaining = weatherMain.includes('rain') || weatherMain.includes('drizzle');
            const isSnowing = weatherMain.includes('snow');
            const isThunderstorm = weatherMain.includes('thunderstorm');
            
            // 기본 옷차림 데이터
            const outfitData = getOutfitByTemperature(currentTemp, feelsLike);
            
            // 날씨 요약 생성
            let weatherSummary = `현재 ${Math.round(currentTemp)}°C, 오늘 ${Math.round(minTemp)}° ~ ${Math.round(maxTemp)}°C 예상됩니다.`;
            
            let tips = [];
            
            if (Math.abs(maxTemp - minTemp) > 8) {
                tips.push('일교차가 크니 겹겹이 입어서 조절하세요');
            }
            
            if (humidity > 75) {
                tips.push('습도가 높아 끈적할 수 있어요');
                outfitData.accessories.push('흡습속건 소재');
            }
            
            if (windSpeed > 4) {
                tips.push('바람이 강하게 불어요');
                outfitData.outer.push('바람막이');
            }
            
            if (isRaining) {
                tips.push('비가 올 예정이니 우산을 챙기세요');
                outfitData.accessories.push('우산', '방수 신발');
            }
            
            if (isSnowing) {
                tips.push('눈이 올 예정이니 미끄럼 주의하세요');
                outfitData.accessories.push('방한 장갑', '방한 부츠');
            }
            
            if (isThunderstorm) {
                tips.push('천둥번개가 있으니 안전에 주의하세요');
            }

            return `
                <h2>👔 오늘의 옷차림</h2>
                
                <div class="weather-summary">
                    <h3>오늘 날씨 요약</h3>
                    <p>${weatherSummary}</p>
                </div>

                <div class="outfit-categories">
                    <div class="outfit-category">
                        <div class="category-header">
                            <span class="category-icon">👕</span>
                            <span class="category-title">상의</span>
                        </div>
                        <div class="category-items">
                            ${outfitData.top.map(item => `<span class="outfit-item">${item}</span>`).join('')}
                        </div>
                    </div>

                    <div class="outfit-category">
                        <div class="category-header">
                            <span class="category-icon">👖</span>
                            <span class="category-title">하의</span>
                        </div>
                        <div class="category-items">
                            ${outfitData.bottom.map(item => `<span class="outfit-item">${item}</span>`).join('')}
                        </div>
                    </div>

                    <div class="outfit-category">
                        <div class="category-header">
                            <span class="category-icon">🧥</span>
                            <span class="category-title">겉옷</span>
                        </div>
                        <div class="category-items">
                            ${outfitData.outer.map(item => `<span class="outfit-item">${item}</span>`).join('')}
                        </div>
                    </div>

                    <div class="outfit-category">
                        <div class="category-header">
                            <span class="category-icon">👟</span>
                            <span class="category-title">신발 & 소품</span>
                        </div>
                        <div class="category-items">
                            ${outfitData.accessories.map(item => `<span class="outfit-item">${item}</span>`).join('')}
                        </div>
                    </div>
                </div>

                ${tips.length > 0 ? `
                    <div class="special-tips">
                        <h4>💡 오늘의 팁</h4>
                        <p>${tips.join(', ')}</p>
                    </div>
                ` : ''}
            `;
        }

        /**
         * 온도별 기본 옷차림 추천
         */
        function getOutfitByTemperature(temp, feelsLike) {
            const effectiveTemp = (temp + feelsLike) / 2;
            
            if (effectiveTemp >= 28) {
                return {
                    top: ['민소매', '반팔 티셔츠', '얇은 셔츠'],
                    bottom: ['반바지', '얇은 바지', '치마'],
                    outer: ['얇은 가디건'],
                    accessories: ['샌들', '모자', '선글라스', '선크림']
                };
            } else if (effectiveTemp >= 23) {
                return {
                    top: ['반팔 티셔츠', '얇은 블라우스', '폴로셔츠'],
                    bottom: ['청바지', '면바지', '치마'],
                    outer: ['얇은 가디건', '셔츠'],
                    accessories: ['운동화', '로퍼', '가벼운 백']
                };
            } else if (effectiveTemp >= 20) {
                return {
                    top: ['긴팔 티셔츠', '얇은 니트', '맨투맨'],
                    bottom: ['청바지', '면바지', '슬랙스'],
                    outer: ['후드티', '얇은 자켓', '가디건'],
                    accessories: ['운동화', '스니커즈']
                };
            } else if (effectiveTemp >= 15) {
                return {
                    top: ['긴팔 티셔츠', '니트', '스웨터'],
                    bottom: ['청바지', '기모바지', '두꺼운 바지'],
                    outer: ['자켓', '가디건', '후드집업'],
                    accessories: ['운동화', '부츠', '얇은 목도리']
                };
            } else if (effectiveTemp >= 10) {
                return {
                    top: ['기모 긴팔', '두꺼운 니트', '플리스'],
                    bottom: ['기모 청바지', '두꺼운 바지'],
                    outer: ['코트', '점퍼', '야상'],
                    accessories: ['부츠', '목도리', '장갑']
                };
            } else {
                return {
                    top: ['기모 내의', '두꺼운 니트', '울 스웨터'],
                    bottom: ['기모 바지', '패딩 바지'],
                    outer: ['패딩', '두꺼운 코트', '롱패딩'],
                    accessories: ['방한 부츠', '장갑', '목도리', '모자', '마스크']
                };
            }
        }

        /**
         * 에러 메시지 표시
         */
        function showError(message) {
            const container = document.getElementById('mainContainer');
            container.innerHTML = `
                <div class="error">
                    ❌ ${message}
                    <br>
                    <button class="retry-btn" onclick="requestLocation()">다시 시도</button>
                </div>
            `;
        }
    </script>
</body>
</html>
